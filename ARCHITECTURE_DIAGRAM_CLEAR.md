# ğŸ“Š Database Clearing Feature - Architecture & Flow

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FRONTEND LAYER (React)                       â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Dashboard Page (src/app/dashboard/page.tsx)            â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  - Search & Filter                                      â”‚  â”‚
â”‚  â”‚  - Sort & Pagination                                    â”‚  â”‚
â”‚  â”‚  - Stats Cards                                          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ TOOLS SECTION                                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â”‚ ClearDataButton Component                â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â”‚ (src/components/ClearDataButton.tsx)      â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â”‚                                            â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â”‚ [ğŸ”´ à¸¥à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”]                     â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â”‚          â†“                                 â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â”‚ â”‚ Modal Dialog (onClick)               â”‚  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â”‚ â”‚                                      â”‚  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â”‚ â”‚ à¸¢à¸·à¸™à¸¢à¸±à¸™à¸à¸²à¸£à¸¥à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥                  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”‚  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â”‚ â”‚ à¸ˆà¸³à¸™à¸§à¸™ Invoices:  5 à¸£à¸²à¸¢à¸à¸²à¸£         â”‚  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â”‚ â”‚ à¸ˆà¸³à¸™à¸§à¸™ Uploads:   2 à¹„à¸Ÿà¸¥à¹Œ           â”‚  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â”‚ â”‚ à¸ˆà¸³à¸™à¸§à¸™ Customers: 3 à¸£à¸²à¸¢           â”‚  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â”‚ â”‚                                      â”‚  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â”‚ â”‚ âš ï¸ à¸à¸²à¸£à¸à¸£à¸°à¸—à¸³à¸™à¸µà¹‰à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸¢à¸à¹€à¸¥à¸´à¸à¹„à¸”à¹‰  â”‚  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â”‚ â”‚                                      â”‚  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â”‚ â”‚ [à¸¢à¸à¹€à¸¥à¸´à¸] [à¸¥à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”]       â”‚  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â”‚ â”‚          â†“ (confirm)                â”‚  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â”‚ â”‚      Loading...                     â”‚  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â”‚                                            â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â”‚ âœ“ à¸¥à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸³à¹€à¸£à¹‡à¸ˆà¹à¸¥à¹‰à¸§ (2sec)           â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â”‚          â†“                                 â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â”‚ Auto-Refresh Page                       â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ fetch()
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API LAYER (Next.js)                          â”‚
â”‚                                                                 â”‚
â”‚  GET /api/invoices/clear                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 1. Check: getServerSession()                           â”‚   â”‚
â”‚  â”‚    â””â”€ If !session â†’ 401 Unauthorized                   â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚ 2. Count records:                                       â”‚   â”‚
â”‚  â”‚    â””â”€ invoiceCount = await prisma.invoice.count()     â”‚   â”‚
â”‚  â”‚    â””â”€ uploadCount = await prisma.upload.count()       â”‚   â”‚
â”‚  â”‚    â””â”€ customerCount = await prisma.customer.count()   â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚ 3. Return { success, counts }                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  POST /api/invoices/clear                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 1. Check: getServerSession()                           â”‚   â”‚
â”‚  â”‚    â””â”€ If !session â†’ 401 Unauthorized                   â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚ 2. Get counts BEFORE delete:                           â”‚   â”‚
â”‚  â”‚    â””â”€ invoiceCount = await prisma.invoice.count()     â”‚   â”‚
â”‚  â”‚    â””â”€ uploadCount = await prisma.upload.count()       â”‚   â”‚
â”‚  â”‚    â””â”€ customerCount = await prisma.customer.count()   â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚ 3. Delete operations:                                  â”‚   â”‚
â”‚  â”‚    â””â”€ await prisma.invoice.deleteMany({})             â”‚   â”‚
â”‚  â”‚    â””â”€ await prisma.upload.deleteMany({})              â”‚   â”‚
â”‚  â”‚    â””â”€ await prisma.customer.deleteMany({})            â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚ 4. Return { success, message, cleared, timestamp }     â”‚   â”‚
â”‚  â”‚    â””â”€ cleared = { invoices, uploads, customers }      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â†“ Prisma
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATABASE LAYER (PostgreSQL)                  â”‚
â”‚                                                                 â”‚
â”‚  PUBLIC SCHEMA:                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Table: User                   [NOT DELETED]             â”‚   â”‚
â”‚  â”‚ - id, email, password, name, created_at               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Table: Invoice                [DELETED âœ“]              â”‚   â”‚
â”‚  â”‚ - id, invoiceNumber, customerId, amount, dueDate       â”‚   â”‚
â”‚  â”‚ - COUNT: 5 â†’ 0                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Table: Upload                 [DELETED âœ“]              â”‚   â”‚
â”‚  â”‚ - id, fileName, userId, uploadedAt                     â”‚   â”‚
â”‚  â”‚ - COUNT: 2 â†’ 0                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Table: Customer               [DELETED âœ“]              â”‚   â”‚
â”‚  â”‚ - id, customerId, name, region, salesPerson            â”‚   â”‚
â”‚  â”‚ - COUNT: 3 â†’ 0                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Table: ReportConfig           [NOT DELETED]             â”‚   â”‚
â”‚  â”‚ - id, name, type, config, userId                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow Sequence

```
USER ACTION                API CALL                DATABASE             UI STATE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€â”€â”€â”€                â”€â”€â”€â”€â”€â”€â”€â”€             â”€â”€â”€â”€â”€â”€â”€â”€

User clicks
"à¸¥à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”"
    â”‚
    â”œâ”€â†’ Modal opens
    â”‚   loading=true
    â”‚
    â”œâ”€â†’ GET /api/clear â”€â”€â”€â”€â”€â”€â†’ Check session â”€â”€â”€â”€â”€â”€â”€â†’ Get counts â”€â”€â†’ counts loaded
    â”‚   (preview)              Count invoices        Invoices: 5     modal shows
    â”‚                         Count uploads         Uploads: 2      counts
    â”‚                         Count customers       Customers: 3
    â”‚
    â”‚   User clicks
    â”‚   "à¸¥à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”"
    â”‚
    â”œâ”€â†’ POST /api/clear â”€â”€â”€â”€â”€â†’ Check session â”€â”€â”€â”€â”€â”€â†’ DELETE FROM    Database
    â”‚   (execute delete)       Count before delete   Invoice;        cleaned
    â”‚                         Delete invoices       DELETE FROM
    â”‚                         Delete uploads        Upload;          UI shows
    â”‚                         Delete customers      DELETE FROM      success
    â”‚                                              Customer;        message
    â”‚                                              Verify delete    (2 sec)
    â”‚
    â””â”€â†’ Auto-refresh â”€â”€â”€â”€â”€â”€â”€â”€â†’ GET /api/invoices â”€â”€â†’ New counts    Dashboard
        page                                        0 invoices     refreshes
                                                    0 uploads      with 0
                                                    0 customers    records
```

## Authentication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NextAuth Session Management                                â”‚
â”‚                                                            â”‚
â”‚ Browser Session Cookie: next-auth.session-token            â”‚
â”‚           â†“                                                 â”‚
â”‚ API Middleware:                                             â”‚
â”‚   getServerSession() â”€â”€â”€â”€â”€â”€â”€â”€â†’ [Valid?]                   â”‚
â”‚                                â”œâ”€ YES: Continue            â”‚
â”‚                                â””â”€ NO: Return 401           â”‚
â”‚                                                            â”‚
â”‚ Protected Endpoints:                                        â”‚
â”‚   - GET /api/invoices/clear (requires auth)               â”‚
â”‚   - POST /api/invoices/clear (requires auth)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Component Props & State

```
ClearDataButton Component
â”œâ”€â”€ No Props (Standalone)
â”‚
â”œâ”€â”€ State:
â”‚   â”œâ”€â”€ isOpen: boolean (modal visible)
â”‚   â”œâ”€â”€ loading: boolean (async operation in progress)
â”‚   â”œâ”€â”€ counts: { invoices, uploads, customers } | null
â”‚   â”œâ”€â”€ error: string | null
â”‚   â””â”€â”€ success: boolean
â”‚
â”œâ”€â”€ Methods:
â”‚   â”œâ”€â”€ handleOpenDialog()
â”‚   â”‚   â””â”€ GET counts & show modal
â”‚   â”‚
â”‚   â”œâ”€â”€ handleConfirmClear()
â”‚   â”‚   â””â”€ POST delete & refresh
â”‚   â”‚
â”‚   â””â”€â”€ handleCancel()
â”‚       â””â”€ Close modal & reset
â”‚
â””â”€â”€ UI Elements:
    â”œâ”€â”€ Button (always visible)
    â”œâ”€â”€ Success message (conditional)
    â”œâ”€â”€ Error message (conditional)
    â””â”€â”€ Modal Dialog
        â”œâ”€â”€ Header
        â”œâ”€â”€ Content (counts display)
        â”œâ”€â”€ Warning box
        â””â”€â”€ Footer (Cancel, Confirm buttons)
```

## Error Handling Flows

```
GET /api/invoices/clear
    â”‚
    â”œâ”€ No Session
    â”‚  â””â”€ Return 401 Unauthorized
    â”‚     â””â”€ Component shows: "à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸”à¹‰"
    â”‚
    â”œâ”€ DB Connection Error
    â”‚  â””â”€ Return 500 Internal Server Error
    â”‚     â””â”€ Component shows: "à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”"
    â”‚
    â””â”€ Success
       â””â”€ Return 200 with counts
          â””â”€ Component shows Modal

POST /api/invoices/clear
    â”‚
    â”œâ”€ No Session
    â”‚  â””â”€ Return 401 Unauthorized
    â”‚     â””â”€ Component shows: "à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸¥à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸”à¹‰"
    â”‚
    â”œâ”€ DB Delete Error
    â”‚  â””â”€ Return 500 Internal Server Error
    â”‚     â””â”€ Component shows: "à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”"
    â”‚
    â””â”€ Success
       â””â”€ Return 200 with cleared counts
          â””â”€ Component shows success message
             â””â”€ Auto-refresh page (2 sec delay)
```

## File Structure & Relationships

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ invoices/
â”‚   â”‚       â””â”€â”€ clear/
â”‚   â”‚           â””â”€â”€ route.ts â—„â”€ API Handler
â”‚   â”‚               â”‚
â”‚   â”‚               â”œâ”€ Import: getServerSession
â”‚   â”‚               â”œâ”€ Import: prisma
â”‚   â”‚               â”œâ”€ Exports: GET, POST
â”‚   â”‚               â””â”€ Response: JSON
â”‚   â”‚
â”‚   â””â”€â”€ dashboard/
â”‚       â””â”€â”€ page.tsx â—„â”€ Dashboard Page
â”‚           â”‚
â”‚           â”œâ”€ Import: ClearDataButton
â”‚           â”œâ”€ Display: Button in Tools section
â”‚           â””â”€ Pass: No props
â”‚
â”œâ”€â”€ components/
â”‚   â””â”€â”€ ClearDataButton.tsx â—„â”€ React Component
â”‚       â”‚
â”‚       â”œâ”€ Import: useState
â”‚       â”œâ”€ Import: fetch API
â”‚       â”œâ”€ State: isOpen, loading, counts, error, success
â”‚       â”œâ”€ Methods: handleOpenDialog, handleConfirmClear
â”‚       â””â”€ Render: Button + Modal UI
â”‚
â””â”€â”€ lib/
    â””â”€â”€ db/
        â””â”€â”€ prisma.ts â—„â”€ Prisma Client
            â”‚
            â””â”€ Used by: route.ts for database queries
                (invoice.count, upload.count, etc.)
```

## Message Localization

```
Thai Language Mapping (à¸ à¸²à¸©à¸²à¹„à¸—à¸¢):

UI Element              Thai Text
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Button Label           à¸¥à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”
Modal Title            à¸¢à¸·à¸™à¸¢à¸±à¸™à¸à¸²à¸£à¸¥à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥
Modal Subtitle         à¸à¸²à¸£à¸à¸£à¸°à¸—à¸³à¸™à¸µà¹‰à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸¢à¸à¹€à¸¥à¸´à¸à¹„à¸”à¹‰
Count Label            à¸ˆà¸³à¸™à¸§à¸™ Invoices:
Count Label            à¸ˆà¸³à¸™à¸§à¸™ Uploads:
Count Label            à¸ˆà¸³à¸™à¸§à¸™ Customers:
Count Unit (Invoices)  à¸£à¸²à¸¢à¸à¸²à¸£
Count Unit (Uploads)   à¹„à¸Ÿà¸¥à¹Œ
Count Unit (Customers) à¸£à¸²à¸¢
Warning Icon           âš ï¸
Warning Message        à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¸”à¹‰à¸²à¸™à¸šà¸™à¸ˆà¸°à¸–à¸¹à¸à¸¥à¸šà¸­à¸­à¸à¸ˆà¸²à¸à¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
Button (Cancel)        à¸¢à¸à¹€à¸¥à¸´à¸
Button (Confirm)       à¸¥à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”
Button (Loading)       à¸à¸³à¸¥à¸±à¸‡à¸¥à¸š...
Success Message        à¸¥à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸³à¹€à¸£à¹‡à¸ˆà¹à¸¥à¹‰à¸§
Error (Fetch)          à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸”à¹‰
Error (Delete)         à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸¥à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸”à¹‰
Error (Generic)        à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”
```

## Performance Characteristics

```
Operation                Time        Database Impact
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
GET /api/invoices/clear ~10-50ms    COUNT only
POST /api/invoices/clear ~100-500ms DELETE operations
Modal Animation         ~200ms       None
Page Auto-refresh       ~1-2 sec     Full reload
Component Load          ~0ms         None
```

## Browser Compatibility

```
âœ“ Chrome/Edge        v90+
âœ“ Firefox            v88+
âœ“ Safari             v14+
âœ“ Mobile Browsers    All modern versions

Features Used:
- fetch API
- CSS Grid/Flexbox
- ES6+ (const, arrow functions)
- React Hooks (useState)
```

---

**Last Updated**: 2024
**Version**: 1.0
**Status**: Production Ready âœ…
